{"version":3,"sources":["../src/datasource.js"],"names":[],"mappings":"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","file":"datasource.js","sourcesContent":["import _ from \"lodash\";\n\n\nexport class NetSpyGlassDatasource {\n\n\n    constructor(instanceSettings, $q, backendSrv, templateSrv) {\n        this.type = instanceSettings.type;\n        this.url = instanceSettings.url;\n        this.name = instanceSettings.name;\n        this.$q = $q;\n        this.backendSrv = backendSrv;\n        this.templateSrv = templateSrv;\n        this.networkId = instanceSettings.jsonData.networkId || 1;\n        this.accessToken = (instanceSettings.jsonData.useToken !== false && instanceSettings.jsonData.accessToken !== undefined && instanceSettings.jsonData.accessToken !== '') ? '?access_token='+instanceSettings.jsonData.accessToken :'';\n        this.endpointsBase = '/v2/grafana/net/' + this.networkId;\n        this.endpoints = {};\n        this.endpoints.category =  this.endpointsBase + '/catalog/categories/list' + this.accessToken;\n        this.endpoints.variable =  this.endpointsBase + '/catalog/categories/';\n        this.endpoints.device =    this.endpointsBase + '/catalog/devices' + this.accessToken;\n        this.endpoints.component = this.endpointsBase + '/catalog/components' + this.accessToken;\n        this.endpoints.tagFacet =  this.endpointsBase + '/catalog/tags/facets' + this.accessToken;\n        this.endpoints.query =     this.endpointsBase + '/query' + this.accessToken;\n        this.endpoints.test =      this.endpointsBase + '/test' + this.accessToken;\n\n        this.targetName = {};\n        this.targetName.variable = 'select variable';\n        this.targetName.device = 'select device';\n        this.targetName.component = 'select component';\n        this.targetName.sortByEl = 'select sorting';\n        this.targetName.selector = 'select selector';\n        this.targetName.limit = 'select limit';\n        this.targetName.group = 'select group';\n        this.targetName.tagFacet = 'select tag facet';\n        this.targetName.tagWord = 'select tag word';\n        this.targetName.interval = 'select interval';\n        this.targetName.tagData = [];\n        this.targetName.resultFormat = '';\n        this.targetName.columns = '';\n\n        this.clearString = '-- clear selection --';\n    }\n\n    buildNewData(item) {\n        var temp = {};\n        for (var key in item) {\n            var result = [];\n            if (!(key in this.targetName)) {\n                continue;\n            }\n            if (typeof item[key] == 'undefined' || item[key] == this.clearString || item[key] == this.targetName[key]) {\n                continue;\n            }\n            if (key == 'tagFacet' || key == 'tagWord') {\n                continue;\n            }\n            if (key == 'tagData') {\n                item[key].forEach(tagsLoop);\n                function tagsLoop(singleItem, index) {\n                    if (singleItem.tagFacet == \"\" || singleItem.tagFacet == \"select tag facet\"){\n                       return;\n                    }\n                    if(singleItem.tagWord == \"\" || singleItem.tagWord == \"select tag word\") {\n                        return;\n                    }\n                    result.push({\n                        tagFacet: singleItem.tagFacet,\n                        tagOperation: singleItem.tagOperation,\n                        tagWord: singleItem.tagWord\n                    });\n\n                }\n            }\n            if (result.length > 0) {\n                temp.tags = result;\n            }\n            if(key !== 'tagData') {\n                temp[key] = item[key];\n            }\n        }\n        return temp;\n    }\n\n\n    buildQuery(options) {\n        var query = this.buildQueryParameters(options);\n        query.targets = query.targets.filter(t => !t.hide);\n        var queryObject = {\n            targets: []\n        };\n        var temp;\n        if (query.targets.length <= 0) {\n            temp = this.buildNewData(query);\n            queryObject.targets.push(temp);\n        } else {\n            var index;\n            for (index = query.targets.length - 1; index >= 0; --index) {\n                temp = this.buildNewData(query.targets[index]);\n                queryObject.targets.push(temp);\n            }\n            if (typeof query.rangeRaw != 'undefined') {\n                queryObject.from = query.rangeRaw.from;\n                queryObject.until = query.rangeRaw.to;\n                queryObject.groupByTime = query.interval;\n            }\n            queryObject.scopedVars = '$variable';\n        }\n        return queryObject;\n    }\n\n    /**\n     * makes actual API call to NetSpyGlass server\n     *\n     * @param endpoint   API call endpoint\n     * @param method     GET or POST\n     * @param query      query object\n     * @returns {*}\n     * @private\n     */\n    _apiCall(endpoint, method, query) {\n        return this.backendSrv.datasourceRequest({\n            url: this.url + endpoint,\n            data: query,\n            method: method,\n            headers: {'Content-Type': 'application/json'}\n        });\n    }\n\n    /**\n     * this function is called when plugin builds a graph\n     *\n     * @param options\n     * @returns {*}\n     */\n    query(options) {\n        var data = this.buildQuery(options);\n        var query = JSON.stringify(data)\n        // replace templated variables\n        query = this.templateSrv.replace(query, options.scopedVars);\n        return this._apiCall(this.endpoints.query, 'POST', query);\n    }\n\n    // Required\n    // Used for testing datasource in datasource configuration page\n    testDatasource() {\n        var endpoint = this.endpoints.test;\n        return this.backendSrv.datasourceRequest({\n            url: this.url + endpoint,\n            method: 'GET'\n        }).then(response => {\n            if (response.status === 200) {\n                return {status: \"success\", message: \"Data source is working\", title: \"Success\"};\n            }\n        });\n    }\n\n    annotationQuery(options) {\n        var query = this.templateSrv.replace(options.annotation.query, {}, 'glob');\n        var annotationQuery = {\n            range: options.range,\n            annotation: {\n                name: options.annotation.name,\n                datasource: options.annotation.datasource,\n                enable: options.annotation.enable,\n                iconColor: options.annotation.iconColor,\n                query: query\n            },\n            rangeRaw: options.rangeRaw\n        };\n        return this.backendSrv.datasourceRequest({\n            url: this.url + '/annotations' + this.accessToken,\n            method: 'POST',\n            data: annotationQuery\n        }).then(result => {\n            return result.data;\n        });\n    }\n\n    /**\n     * generic query. Grafana calls this function when it needs to get list of values for a dashboard\n     * template variable.\n     *\n     * Note that NetSpyGlass /catalog/ requests return a list of strings, but plugin requires\n     * list of {text: AA, value: BB} (where AA and BB can be the same)\n     *\n     * @param query     query object as text string\n     * @returns {Promise.<TResult>}\n     */\n    metricFindQuery(query) {\n        var interpolated;\n        try {\n            // interpolated = this.templateSrv.replace(query, null, 'regex');\n            // replace templated variables\n            interpolated = this.templateSrv.replace(query, query.scopedVars);\n        } catch (err) {\n            return this.$q.reject(err);\n        }\n        var data = this.buildQuery(interpolated);\n        var columns = data.targets[0].columns;\n        var endpoint = this.endpointsBase + '/catalog/' + columns;\n        return this._apiCall(endpoint, 'POST', JSON.stringify(data)).then(this.mapToTextText);\n    }\n\n    findCategoriesQuery() {\n        return this._apiCall(this.endpoints.category, 'POST', '').then(this.mapToTextValue);\n    }\n\n    findVariablesQuery(options) {\n        var endpoint = this.endpoints.variable + options.category + this.accessToken;\n        return this._apiCall(endpoint, 'POST', '').then(this.mapToTextValue);\n    }\n\n    findDevices(options) {\n        var data = this.buildQuery(options);\n        var query = JSON.stringify(data)\n        // replace templated variables\n        query = this.templateSrv.replace(query, options.scopedVars);\n        return this._apiCall(this.endpoints.device, 'POST', query).then(this.mapToTextValue);\n    }\n\n    findComponents(options) {\n        var data = this.buildQuery(options);\n        data.targets[0].component = '';  // erase it to ignore current selection in the dialog \n        var query = JSON.stringify(data);\n        // replace templated variables\n        query = this.templateSrv.replace(query, options.scopedVars);\n        return this._apiCall(this.endpoints.component, 'POST', query).then(this.mapToTextValue);\n    }\n\n    findTagFacets(options) {\n        var data = this.buildQuery(options);\n        var query = JSON.stringify(data)\n        // replace templated variables\n        query = this.templateSrv.replace(query, options.scopedVars);\n        return this._apiCall(this.endpoints.tagFacet, 'POST', query).then(this.mapToTextValue);\n    }\n\n    findTagWordsQuery(options, facet) {\n        var data = this.buildQuery(options);\n        var query = JSON.stringify(data)\n        // replace templated variables\n        query = this.templateSrv.replace(query, options.scopedVars);\n        var endpoint = this.endpointsBase + '/catalog/tags/' + facet + this.accessToken;\n        return this._apiCall(endpoint, 'POST', query).then(this.mapToTextValue);\n    }\n\n    mapToTextValue(result) {\n        return _.map(result.data, (d, i) => {\n            return {text: d, value: i};\n        });\n    }\n\n    mapToTextText(result) {\n        return _.map(result.data, (d, i) => {\n            return {text: d, value: d};\n        });\n    }\n\n    debug(ctrl) {\n        console.log(ctrl);\n    }\n\n    /**\n     * when building graphing query, this function is called with JS object that has at least\n     * attribute 'targets'\n     *\n     * when building query for the templating variable in dashboard template, this is called with\n     * whatever user entered in the Query Options -> Query input field (a string)\n     *\n     * @param options\n     * @returns {*}\n     */\n    buildQueryParameters(options) {\n\n        if (typeof options === 'string') {\n            var obj = {\n                'targets': []\n            };\n            obj.targets.push(JSON.parse(options));\n            return obj;\n        }\n\n        var targets = _.map(options.targets, target => {\n            return {\n                category: this.templateSrv.replace(target.category),\n                variable: this.templateSrv.replace(target.variable),\n                device: this.templateSrv.replace(target.device),\n                component: this.templateSrv.replace(target.component),\n                tagFacet: this.templateSrv.replace(target.tagFacet),\n                tagOperation: this.templateSrv.replace(target.tagOperation),\n                tagWord: this.templateSrv.replace(target.tagWord),\n                sortByEl: this.templateSrv.replace(target.sortByEl),\n                selector: this.templateSrv.replace(target.selector),\n                resultFormat: this.templateSrv.replace(target.resultFormat),\n                limit: (target.limit === '') ? -1 : this.templateSrv.replace(target.limit),\n                columns: this.templateSrv.replace(target.columns),\n                alias: this.templateSrv.replace(target.alias, options.scopedVars),\n                refId: target.refId,\n                hide: target.hide,\n                tagData: target.tagData\n            };\n        });\n\n        options.targets = targets;\n\n        return options;\n    }\n}"]}